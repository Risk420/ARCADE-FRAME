<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Arcade Studio</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gif.js/0.2.0/gif.js"></script>

<style>
  /* GLOBAL SCROLLING ENABLED */
  html { scroll-behavior: smooth; overflow-y: auto; }
  body {
    background: #0a0a0c; color: white; font-family: sans-serif;
    display: flex; flex-direction: column; align-items: center;
    min-height: 100vh; margin: 0; padding-bottom: 150px; 
    -webkit-overflow-scrolling: touch; 
    background-image: linear-gradient(rgba(255,255,255,0.05) 1px, transparent 1px);
    background-size: 100% 4px;
    touch-action: pan-y; 
  }
  
  /* --- NAVIGATION --- */
  .menu-toggle { position: fixed; top: 15px; left: 15px; background: #1a1a1c; color: #fff; border: 1px solid rgba(255,255,255,0.1); padding: 8px 12px; border-radius: 4px; font-weight: bold; cursor: pointer; z-index: 100000; font-size: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.5); }
  .switch-container { position: fixed; top: 15px; right: 15px; z-index: 100000; }
  #switch-btn { background: #ff0000; color: white; border: 2px solid #ffffff; padding: 8px 14px; border-radius: 4px; font-weight: bold; cursor: pointer; font-size: 11px; text-transform: uppercase; letter-spacing: 1px; box-shadow: 0 0 10px rgba(255,0,0,0.5); display: flex; gap: 5px; align-items: center; }
  #switch-menu { position: absolute; top: 45px; right: 0; background: #1a1a1c; border: 1px solid #ff0000; border-radius: 8px; width: 220px; display: none; flex-direction: column; overflow: hidden; box-shadow: 0 10px 20px rgba(0,0,0,0.8); }
  #switch-menu button { background: transparent; color: #aaa; border: none; padding: 14px; text-align: left; font-weight: bold; font-size: 11px; cursor: pointer; border-bottom: 1px solid rgba(255,255,255,0.05); text-transform: uppercase; }
  #switch-menu button.active-link { color: #00ffff; background: rgba(0,255,255,0.1); border-left: 3px solid #00ffff; }

  /* SIDE PANEL */
  #menu-panel { position: fixed; top: 0; left: -260px; width: 240px; height: 100%; background: #1a1a1c; padding-top: 60px; transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); z-index: 99999; display: flex; flex-direction: column; gap: 10px; padding-left: 15px; padding-right: 15px; box-shadow: 2px 0 15px rgba(0,0,0,0.5); box-sizing: border-box; padding-bottom: 80px; }
  #menu-panel.open { left: 0; }
  .designed-by { position: absolute; bottom: 0; left: 0; width: 100%; padding: 20px 0; border-top: 1px solid rgba(255,255,255,0.1); text-align: center; font-size: 11px; font-weight: 900; color: #888; text-transform: uppercase; letter-spacing: 2px; background: #1a1a1c; }
  .designed-by b { color: #ff0000; text-shadow: 0 0 8px rgba(255,0,0,0.6); }

  /* HEADERS */
  h1 { color: #fff; margin: 60px 0 0 0; font-family: "Arial Black", sans-serif; font-style: italic; font-size: 36px; text-transform: uppercase; letter-spacing: -1px; text-shadow: 2px 2px 0px #ff0000, -1px -1px 10px rgba(255, 0, 0, 0.8); animation: arcadeBounce 1.8s infinite ease-in-out; }
  @keyframes arcadeBounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
  .sub { color: #fff; font-weight: bold; margin: 2px 0 15px 0; text-transform: uppercase; font-size: 11px; letter-spacing: 2px; text-align: center; }
  .studio-sec { display: none; width: 320px; flex-direction: column; align-items: center; }
  .active-sec { display: flex; }

  /* üñºÔ∏è FRAME STUDIO */
  #box { position: relative; width: 310px; height: 310px; border-radius: 50%; overflow: hidden; background-image: linear-gradient(45deg, #1a1a1c 25%, transparent 25%), linear-gradient(-45deg, #1a1a1c 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #1a1a1c 75%), linear-gradient(-45deg, transparent 75%, #1a1a1c 75%); background-color: transparent; background-size: 20px 20px; box-shadow: 0 0 20px rgba(0,0,0,0.5); -webkit-mask-image: -webkit-radial-gradient(white,black); z-index: 10; }
  canvas#c { position: absolute; top: 0; left: 0; width: 310px; height: 310px; z-index: 15; touch-action: none; }

  /* üé¨ GIF STUDIO */
  .gif-stage { position: relative; width: 310px; height: 310px; margin-bottom: 30px; touch-action: none; }
  .led-ring { position: absolute; inset: -15px; border-radius: 50%; background: conic-gradient(from 180deg, #00f3ff, #bc13fe, #00f3ff); animation: rotate 3s linear infinite; filter: blur(25px); z-index: 1; pointer-events: none; }
  .viewport { position: relative; z-index: 5; width: 100%; height: 100%; border-radius: 50%; overflow: hidden; background-color: #000; background-image: linear-gradient(45deg, #111 25%, transparent 25%), linear-gradient(-45deg, #111 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #111 75%), linear-gradient(-45deg, transparent 75%, #111 75%); background-size: 20px 20px; box-shadow: inset 0 0 30px #000; }
  #v_gif { position: absolute; top: 0; left: 0; pointer-events: none; }
  #o_gif { width: 100%; height: 100%; object-fit: cover; display: none; }
  @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
  .ui-panel { background: #151517; padding: 25px; border-radius: 35px; width: 310px; border: 1px solid rgba(255,255,255,0.05); display: flex; flex-direction: column; align-items: center; box-shadow: 0 20px 50px rgba(0,0,0,0.5); box-sizing: border-box; }
  .btn-upload { background: #2a2a2e; color: #fff; border: 1px solid rgba(255,255,255,0.1); padding: 12px 25px; border-radius: 50px; font-weight: 800; cursor: pointer; width: 100%; margin-bottom: 25px; font-size: 12px; text-transform: uppercase; }
  .btn-go { background: linear-gradient(180deg, #ffcc33, #d4af37); color: #000; border: none; padding: 18px; width: 100%; border-radius: 18px; cursor: pointer; font-weight: 900; font-size: 15px; }
  #msg_gif { margin-top: 15px; font-size: 13px; color: #00f3ff; font-weight: 600; visibility: hidden; }
  .neon-wrap { position: relative; display: none; margin-top: 15px; padding: 3px; border-radius: 50px; overflow: hidden; width: 100%; }
  .neon-wrap.blue::before { content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: conic-gradient(transparent, #00f3ff, #bc13fe, transparent); animation: rotate 2s linear infinite; }
  .neon-wrap.red::before { content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: conic-gradient(transparent, #ff0055, #ff5500, transparent); animation: rotate 2s linear infinite; }
  .btn-inner { position: relative; display: block; text-decoration: none; text-align: center; color: white; background: #000; padding: 14px; border-radius: 48px; font-weight: 900; font-size: 13px; z-index: 1; cursor: pointer; border: none; }

  /* ‚úçÔ∏è FONT GENERATOR UI */
  .font-input { width: 100%; background: #111; border: 2px solid #00ffff; color: #fff; padding: 15px; border-radius: 8px; font-weight: bold; text-align: center; margin-bottom: 15px; font-size: 16px; outline: none; box-sizing: border-box; }
  .font-scroll { width: 100%; max-height: 500px; overflow-y: auto; display: flex; flex-direction: column; gap: 0; border-radius: 8px; overflow-x: hidden; border: 1px solid rgba(255,255,255,0.1); box-sizing: border-box; touch-action: pan-y; }
  .font-item { background: #1a1a1c; border: none; border-bottom: 1px solid rgba(255,255,255,0.1); padding: 16px; width: 100%; text-align: center; cursor: pointer; color: #eee; white-space: pre-wrap; overflow-wrap: break-word; box-sizing: border-box; font-size: 16px; }
  .font-item:active { background: #00ffff; color: #000; }

  /* UI GLOBAL SLIDERS */
  .ui { margin-top: 20px; width: 310px; display: flex; flex-direction: column; gap: 6px; }
  .btn { background: #111; border: 2px solid #ffffff; color: white; padding: 10px; text-align: center; border-radius: 8px; font-weight: bold; display: block; font-size: 12px; cursor: pointer; text-transform: uppercase; }
  .lbl { font-size: 9px; color: #888; text-transform: uppercase; margin-top: 2px; display: flex; justify-content: space-between; align-items: center; width: 100%; font-weight: bold; }
  .val-tag { color: #ff0000; font-weight: bold; font-family: monospace; font-size: 10px; }
  input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; margin: 10px 0; cursor: pointer; }
  input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 8px; background: linear-gradient(to right, #ff0000 var(--v, 0%), #00ffff var(--v, 0%)); border-radius: 4px; }
  input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 20px; width: 20px; border-radius: 50%; background: #ff0000; margin-top: -6px; border: 2px solid #ffffff; }
  #save { background: #ff0000; border: none; font-size: 14px; color: white; padding: 12px; border-radius: 8px; font-weight: bold; margin-top: 10px; cursor: pointer; text-transform: uppercase; opacity: 1; }
</style>
</head>
<body onclick="startAudio()">

<button class="menu-toggle" onclick="toggleMenu(event)">MENU ‚ò∞</button>

<div class="switch-container">
  <button id="switch-btn" onclick="toggleSwitchMenu(event)">SWITCH TO üìÇ</button>
  <div id="switch-menu">
    <button id="nav-frame" class="active-link" onclick="changeStudio('frame')">üñºÔ∏è Frame Studio</button>
    <button id="nav-font" onclick="changeStudio('font')">‚úçÔ∏è Font Generator</button>
    <button id="nav-gif" onclick="changeStudio('gif')">üé¨ GIF Studio</button>
  </div>
</div>

<div id="menu-panel">
  <div class="designed-by">DESIGNED BY <b>RISK</b></div>
</div>

<h1 id="studio-name">ARCADE</h1>
<p class="sub" id="studio-sub">FRAME STUDIO</p>

<div id="frame-studio" class="studio-sec active-sec">
  <div id="box"><canvas id="c" width="800" height="800"></canvas></div>
  <div class="ui">
    <label class="btn">CHOOSE IMAGE<input type="file" id="u1" accept="image/*" onchange="handleFile(event)" style="display:none"></label>
    <button class="btn" style="border-color:#00ffff; color:#00ffff;" onclick="centerSubject()">CENTER SUBJECT üéØ</button>
    <div class="lbl">ZOOM <span id="z-val" class="val-tag">100%</span></div>
    <input type="range" id="z" min="0.1" max="4" step="0.01" value="1" oninput="updateZ(this.value)">
    <div class="lbl">CIRCLE SIZE <span id="m-val" class="val-tag">375px</span></div>
    <input type="range" id="m" min="300" max="400" step="1" value="375" oninput="updateM(this.value)">
    <button id="save" onclick="downloadPic()">DOWNLOAD PICTURE</button>
  </div>
</div>

<div id="font-studio" class="studio-sec">
  <input type="text" id="font-input" class="font-input" placeholder="Type text here..." oninput="genFonts()">
  <div class="lbl">TAP TO COPY <span class="val-tag" id="font-count">0 STYLES</span></div>
  <div id="font-results" class="font-scroll"></div>
</div>

<div id="gif-studio" class="studio-sec">
    <div class="gif-stage">
      <div class="led-ring"></div>
      <div class="viewport" id="vp_gif">
        <video id="v_gif" muted playsinline loop></video>
        <img id="o_gif">
      </div>
    </div>
    <div class="ui-panel">
      <div class="lbl">ZOOM / SCALE <span id="gzv" class="val-tag">100%</span></div>
      <input type="range" id="gzoom" min="100" max="300" value="100" oninput="updateGZoom()">
      <button class="btn-upload" onclick="document.getElementById('gf').click()">UPLOAD YOUR VIDEO</button>
      <input type="file" id="gf" accept="video/*" style="display:none" onchange="handleGifFile(event)">
      <div class="lbl">PLAYBACK SPEED <span id="gsv" class="val-tag">1.0x</span></div>
      <input type="range" id="gspeed" min="0.5" max="3.0" step="0.1" value="1.0" oninput="updateGSpeed()">
      <button id="go_gif" class="btn-go" onclick="createGif()">‚ö° CREATE HD GIF</button>
      <div id="msg_gif">Processing...</div>
      <div id="dlBox_gif" class="neon-wrap blue"><a id="dl_gif" class="btn-inner">‚¨áÔ∏è DOWNLOAD GIF</a></div>
      <div id="resetBox_gif" class="neon-wrap red"><button class="btn-inner" onclick="location.reload()">‚Üª RESET PROJECT</button></div>
    </div>
</div>

<script>
// --- GLOBAL ---
const sName=document.getElementById('studio-name'), sSub=document.getElementById('studio-sub'), swMenu=document.getElementById('switch-menu'), panel=document.getElementById('menu-panel');

function changeStudio(mode) {
  document.querySelectorAll('.studio-sec').forEach(s => s.classList.remove('active-sec'));
  document.querySelectorAll('#switch-menu button').forEach(b => b.classList.remove('active-link'));
  swMenu.style.display = 'none';
  if(mode === 'frame') {
    document.getElementById('frame-studio').classList.add('active-sec'); document.getElementById('nav-frame').classList.add('active-link');
    sName.innerText = "ARCADE"; sSub.innerText = "FRAME STUDIO";
  } else if(mode === 'font') {
    document.getElementById('font-studio').classList.add('active-sec'); document.getElementById('nav-font').classList.add('active-link');
    sName.innerText = "FONTS"; sSub.innerText = "GENERATOR STUDIO";
  } else {
    document.getElementById('gif-studio').classList.add('active-sec'); document.getElementById('nav-gif').classList.add('active-link');
    sName.innerText = "GIFS"; sSub.innerText = "ARCADE GIF STUDIO";
  }
}
function toggleSwitchMenu(e) { e.stopPropagation(); swMenu.style.display = swMenu.style.display === 'flex' ? 'none' : 'flex'; }
function toggleMenu(e) { e.stopPropagation(); panel.classList.toggle('open'); }
function startAudio() {}

// --- ‚úçÔ∏è RESTORED 1000+ FONT ENGINE ---
const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
const bases = [
  {m:"ùêÄùêÅùêÇùêÉùêÑùêÖùêÜùêáùêàùêâùêäùêãùêåùêçùêéùêèùêêùêëùêíùêìùêîbatchùêïùêñùêóùêòùêôùêöùêõùêúùêùùêûùêüùê†ùê°ùê¢ùê£ùê§ùê•ùê¶ùêßùê®ùê©ùê™ùê´ùê¨ùê≠ùêÆùêØùê∞ùê±ùê≤ùê≥ùüéùüèùüêùüëùüíùüìùüîùüïùüñùüó"}, 
  {m:"ùê¥ùêµùê∂ùê∑ùê∏ùê±ùê∫ùêªùêºùêΩùêæùêøùëÄùëÅùëÇùëÉùëÑùëÖùëÜùëáùëàùëâùëäùëãùëåùëçùëéùëèùëêùëëùëíùëóùëòùëôùëöùëõùëúùëùùëûùëüùë†ùë°ùë¢ùë£ùë§ùë•ùë¶ùëß0123456789"},
  {m:"ùë®ùë©ùë™ùë´ùë¨ùë≠ùëÆùëØùë∞ùë±ùë≤ùë≥ùë¥ùëµùë∂ùë∑ùë∏ùëπùë∫ùëªùëºùëΩùëæùëøùíÄùíÅùíÇùíÉùíÑùíÖùíÜùíáùíàùíâùíäùíãùíåùíçùíéùíèùíêùíëùííùíìùíîùíïùíñùíóùíòùíôùíöùíõ0123456789"},
  {m:"ùíú‚Ñ¨ùíûùíü‚Ñ∞‚Ñ±ùí¢‚Ñã‚Ñêùí•ùí¶‚Ñí‚Ñ≥ùí©ùí™ùí´ùí¨‚ÑõùíÆùíØùí∞ùí±ùí≤ùí≥ùí¥ùíµùí∂ùí∑ùí∏ùíπ‚ÑØùíª‚ÑäùíΩùíæùíøùìÄùìÅùìÇùìÉ‚Ñ¥ùìÖùìÜùìáùìàùìâùìäùìãùìåùìçùìéùìè0123456789"},
  {m:"ùìêùìëùìíùììùìîùìïùìñùìóùìòùìôùìöùìõùìúùìùùìûùìüùì†ùì°ùì¢ùì£ùì§ùì•ùì¶ùìßùì®ùì©ùì™ùì´ùì¨ùì≠ùìÆùìØùì∞ùì±ùì≤ùì≥ùì¥ùìµùì∂ùì∑ùì∏ùìπùì∫ùìªùìºùìΩùìæùìøùîÄùîÅùîÇùîÉ0123456789"},
  {m:"ùîÑùîÖ‚Ñ≠ùîáùîàùîâùîä‚Ñå‚Ñëùîçùîéùîèùîêùîëùîíùîìùîî‚Ñúùîñùîóùîòùîôùîöùîõùîúùîùùîûùîüùî†ùî°ùî¢ùî£ùî§ùî•ùî¶ùîßùî®ùî©ùî™ùî´ùî¨ùî≠ùîÆùîØùî∞ùî±ùî≤ùî≥ùî¥ùîµùî∂ùî∑0123456789"},
  {m:"ùï¨ùï≠ùïÆùïØùï∞ùï±ùï≤ùï≥ùï¥ùïµùï∂ùï∑ùï∏ùïπùï∫ùïªùïºùïΩùïæùïøùñÄùñÅùñÇùñÉùñÑùñÖùñÜùñáùñàùñâùñäùñãùñåùñçùñéùñèùñêùñëùñíùñìùñîùñïùññùñóùñòùñôùñöùñõùñúùñùùñûùñü0123456789"},
  {m:"ùî∏ùîπ‚ÑÇDoubleùîΩùîæ‚ÑçùïÄùïÅùïÇùïÉùïÑ‚ÑïùïÜ‚Ñô‚Ñö‚Ñùùïäùïãùïåùïçùïéùïèùïê‚Ñ§ùïíùïìùïîùïïùïñùïóùïòùïôùïöùïõùïúùïùùïûùïüùï†ùê©ùï¢ùï£ùï§ùï•ùï¶ùïßùï®ùï©ùï™ùï´ùüòùüôùüöùüõùüúùüùùüûùüüùü†ùü°"}
];
const decorators = ["‚òÖ|‚òÖ", "„Äé|„Äè", "„Äê|„Äë", "ÍßÅ|ÍßÇ", "ÀóÀè|ÀéÀó", "‚òæ|‚òΩ", "‚ù§|‚ù§", "‚ö°|‚ö°", "‚ôõ|‚ôõ", "‚àû|‚àû", "¬ß|¬ß", "‚Ç™|‚Ç™"];

function genFonts() {
  const val = document.getElementById('font-input').value, resBox = document.getElementById('font-results');
  resBox.innerHTML = ""; if(!val) return;
  let count = 0;
  bases.forEach(b => {
    let baseTxt = mapText(val, b.m);
    addF(baseTxt, resBox); count++;
    decorators.forEach(dec => {
      let [p,s] = dec.split("|");
      addF(p + baseTxt + (s||p), resBox); count++;
    });
  });
  document.getElementById('font-count').innerText = count + " STYLES";
}
function mapText(t, m) { let r="", mArr=Array.from(m); for(let char of t) { let idx=chars.indexOf(char); r += (idx !== -1 && mArr[idx]) ? mArr[idx] : char; } return r; }
function addF(t, b) { let d=document.createElement('div'); d.className="font-item"; d.innerText=t; d.onclick=()=>navigator.clipboard.writeText(t); b.appendChild(d); }

// --- üé¨ GIF.JS WEB WORKER ENGINE ---
const vG=document.getElementById('v_gif'), oG=document.getElementById('o_gif'), vpG=document.getElementById('vp_gif');
let isDrgG=false, gStartX, gStartY, gStartL, gStartT, nW, nH;

function handleGifFile(e){ const f=e.target.files[0]; if(!f)return; vG.src=URL.createObjectURL(f); vG.onloadedmetadata=()=>{nW=vG.videoWidth; nH=vG.videoHeight; alignVideo(); vG.play();}; }
function alignVideo(){ vG.style.left='0px'; vG.style.top='0px'; const asp=nW/nH; if(asp>1){vG.style.height='310px'; vG.style.width=(310*asp)+'px';}else{vG.style.width='310px';vG.style.height=(310/asp)+'px';} }
function updateGZoom(){ document.getElementById('gzv').innerText=document.getElementById('gzoom').value+'%'; const z=parseInt(document.getElementById('gzoom').value)/100, asp=nW/nH; let bW=asp>1?310*asp:310, bH=asp>1?310:310/asp; vG.style.width=(bW*z)+'px'; vG.style.height=(bH*z)+'px'; }
function updateGSpeed(){ vG.playbackRate=parseFloat(document.getElementById('gspeed').value); }

vpG.ontouchstart=e=>{isDrgG=true; gStartX=e.touches[0].pageX; gStartY=e.touches[0].pageY; gStartL=parseFloat(vG.style.left||0); gStartT=parseFloat(vG.style.top||0);};
window.addEventListener('touchmove', e=>{if(!isDrgG)return; vG.style.left=(gStartL+(e.touches[0].pageX-gStartX))+'px'; vG.style.top=(gStartT+(e.touches[0].pageY-gStartY))+'px';}, {passive:false});
window.addEventListener('touchend', ()=>{isDrgG=false;});

function createGif(){
  if(!vG.src)return; document.getElementById('go_gif').disabled=true; document.getElementById('msg_gif').style.visibility="visible";
  const workerBlob = new Blob([`importScripts('https://cdnjs.cloudflare.com/ajax/libs/gif.js/0.2.0/gif.worker.js');`], {type: 'application/javascript'});
  const gif = new GIF({ workers: 2, quality: 10, width: 480, height: 480, workerScript: URL.createObjectURL(workerBlob) });
  const cvs = document.createElement('canvas'); cvs.width = 480; cvs.height = 480; const ctx = cvs.getContext('2d');
  const dur = vG.duration, capV = document.createElement('video'); capV.src = vG.src;
  capV.onloadeddata = () => {
    const rW = nW/parseFloat(vG.style.width), rH = nH/parseFloat(vG.style.height);
    let cT = 0; const cap = () => { if(cT >= dur) { gif.render(); return; } capV.currentTime = cT; };
    capV.onseeked = () => { ctx.drawImage(capV, Math.abs(parseFloat(vG.style.left||0))*rW, Math.abs(parseFloat(vG.style.top||0))*rH, 310*rW, 310*rH, 0, 0, 480, 480); gif.addFrame(ctx, {copy: true, delay: (1000/24)/parseFloat(document.getElementById('gspeed').value)}); cT += (1/24); cap(); }; cap();
  };
  gif.on('finished', blob => { const url = URL.createObjectURL(blob); oG.src = url; vG.style.display = 'none'; oG.style.display = 'block'; document.getElementById('dl_gif').href = url; document.getElementById('dl_gif').download = `neon_focus_${Date.now()}.gif`; document.getElementById('dlBox_gif').style.display = 'block'; document.getElementById('resetBox_gif').style.display = 'block'; document.getElementById('msg_gif').style.visibility = "hidden"; document.getElementById('go_gif').disabled = false; });
}

// --- üñºÔ∏è FRAME ENGINE ---
const canvas=document.getElementById('c'), x=canvas.getContext('2d');
let img_i=new Image(), cfg={s:1, m:375, x:400, y:400, lx:0, ly:0};
function d(){ x.clearRect(0,0,800,800); x.save(); x.beginPath(); x.arc(400,400,cfg.m,0,6.28); x.clip(); if(img_i.src) x.drawImage(img_i, 400-(img_i.width*cfg.s)/2 + (cfg.x-400), 400-(img_i.height*cfg.s)/2 + (cfg.y-400), img_i.width*cfg.s, img_i.height*cfg.s); x.restore(); }
function handleFile(e){ let r=new FileReader(); r.onload=v=>{ let n=new Image(); n.onload=()=>{img_i=n; cfg.s=800/img_i.width; d();}; n.src=v.target.result; }; r.readAsDataURL(e.target.files[0]); }
function updateZ(v){ cfg.s=parseFloat(v); document.getElementById('z-val').innerText=Math.round(v*100)+"%"; d(); }
function updateM(v){ cfg.m=parseInt(v); document.getElementById('m-val').innerText=v+"px"; d(); }
function centerSubject(){ cfg.x=400; cfg.y=400; d(); }
function downloadPic(){ let a=document.createElement('a'); a.download='arcade.png'; a.href=canvas.toDataURL(); a.click(); }
canvas.addEventListener('touchstart', e=>{if(e.touches.length===1){cfg.lx=e.touches[0].clientX-cfg.x; cfg.ly=e.touches[0].clientY-cfg.y;}}, {passive:false});
canvas.addEventListener('touchmove', e=>{e.preventDefault(); if(e.touches.length===1){cfg.x=e.touches[0].clientX-cfg.lx; cfg.y=e.touches[0].clientY-cfg.ly;} d();}, {passive:false});

function updS(el){ el.style.setProperty('--v', ((el.value-el.min)/(el.max-el.min)*100)+'%'); }
document.querySelectorAll('input[type=range]').forEach(el => { el.addEventListener('input', () => updS(el)); updS(el); });
</script>
</body>
</html>
