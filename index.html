<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Arcade Studio</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/gif.js/0.2.0/gif.js"></script>

<style>
  /* --- GLOBAL SETTINGS --- */
  html { scroll-behavior: smooth; overflow-y: auto; }
  body {
    background: #0a0a0c; color: white; font-family: sans-serif;
    display: flex; flex-direction: column; align-items: center;
    min-height: 100vh; margin: 0; padding-bottom: 150px; 
    -webkit-overflow-scrolling: touch; 
    background-image: linear-gradient(rgba(255,255,255,0.05) 1px, transparent 1px);
    background-size: 100% 4px; touch-action: pan-y; 
  }

  /* --- CUSTOM SCROLLBAR --- */
  ::-webkit-scrollbar { width: 12px; }
  ::-webkit-scrollbar-track { background: #0a0a0c; border-left: 1px solid #333; }
  ::-webkit-scrollbar-thumb { background: #333; border-radius: 6px; border: 2px solid #0a0a0c; }
  ::-webkit-scrollbar-thumb:hover { background: #00ffff; }

  /* --- NAVIGATION --- */
  .menu-toggle { 
    position: fixed; top: 15px; left: 15px; 
    background: #1a1a1c; color: #fff; border: 1px solid rgba(255,255,255,0.1); 
    padding: 8px 12px; border-radius: 4px; font-weight: bold; cursor: pointer; 
    z-index: 100000; font-size: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.5); 
  }

  #view-toggle {
    position: fixed; top: 15px; right: 15px; 
    background: #1a1a1c; color: #fff; border: 1px solid #00ffff; 
    padding: 8px 12px; border-radius: 4px; font-weight: bold; cursor: pointer; 
    z-index: 100000; font-size: 16px; box-shadow: 0 0 10px rgba(0,255,255,0.2);
  }

  #menu-panel { 
    position: fixed; top: 0; left: -260px; width: 240px; height: 100%; 
    background: #1a1a1c; padding-top: 60px; transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
    z-index: 99999; display: flex; flex-direction: column; gap: 15px; 
    padding-left: 15px; padding-right: 15px; box-shadow: 2px 0 15px rgba(0,0,0,0.5); 
    box-sizing: border-box; padding-bottom: 80px; 
  }
  #menu-panel.open { left: 0; }

  .switch-container { position: relative; width: 100%; }
  #switch-btn { 
    background: rgba(255,255,255,0.05); color: white; border: 2px solid #ff0000; 
    padding: 10px; border-radius: 4px; font-weight: bold; cursor: pointer; 
    font-size: 11px; text-transform: uppercase; width: 100%; text-align: center;
    box-shadow: 0 0 10px rgba(255,0,0,0.5); 
  }
  #switch-menu { 
    position: absolute; top: 45px; right: 0; background: #1a1a1c; 
    border: 1px solid #ff0000; border-radius: 8px; width: 210px; 
    display: none; flex-direction: column; overflow: hidden; 
    box-shadow: 0 10px 20px rgba(0,0,0,0.8); z-index: 100001;
  }
  #switch-menu button { 
    background: transparent; color: #aaa; border: none; padding: 14px; 
    text-align: left; font-weight: bold; font-size: 11px; cursor: pointer; 
    border-bottom: 1px solid rgba(255,255,255,0.05); text-transform: uppercase;
  }
  #switch-menu button.active-link { color: #00ffff; background: rgba(0,255,255,0.1); border-left: 3px solid #00ffff; }

  .designed-by { position: absolute; bottom: 0; left: 0; width: 100%; padding: 20px 0; border-top: 1px solid rgba(255,255,255,0.1); text-align: center; font-size: 11px; font-weight: 900; color: #888; background: #1a1a1c; }
  .designed-by b { color: #ff0000; text-shadow: 0 0 8px rgba(255,0,0,0.6); }

  .music-section { border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.03); border-radius: 6px; padding: 10px; display: flex; flex-direction: column; gap: 8px; }
  .menu-lbl { font-size: 10px; font-weight: 900; color: #00ffff; text-transform: uppercase; margin-bottom: 5px; }
  .lnk { display: flex; align-items: center; gap: 10px; padding: 12px; text-decoration: none; color: white; font-size: 13px; font-weight: bold; border-radius: 4px; border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); }
  .lnk svg { width: 18px; height: 18px; fill: white; }

  /* HEADERS */
  h1 { color: #fff; margin: 60px 0 0 0; font-family: "Arial Black", sans-serif; font-style: italic; font-size: 36px; text-transform: uppercase; letter-spacing: -1px; text-shadow: 2px 2px 0px #ff0000, -1px -1px 10px rgba(255, 0, 0, 0.8); animation: arcadeBounce 1.8s infinite ease-in-out; }
  @keyframes arcadeBounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
  .sub { color: #fff; font-weight: bold; margin: 2px 0 15px 0; text-transform: uppercase; font-size: 11px; letter-spacing: 2px; text-align: center; }
  
  /* --- LAYOUT LOGIC --- */
  .studio-sec { display: none; width: 320px; flex-direction: column; align-items: center; }
  .active-sec { display: flex; }

  /* --- PC MODE STYLES --- */
  body.pc-mode { justify-content: flex-start; padding-top: 40px; }
  body.pc-mode .studio-sec { width: 90%; max-width: 1100px; flex-direction: row; align-items: flex-start; justify-content: center; gap: 60px; }
  body.pc-mode .ui, body.pc-mode .ui-gif { width: 350px; margin-top: 0; }
  body.pc-mode #font-results { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; max-height: 70vh; overflow-y: scroll; }

  /* --- üñºÔ∏è FRAME STUDIO CSS --- */
  @keyframes neonPulse {
    0% { box-shadow: 0 0 20px #ff0000, inset 0 0 10px #ff0000; border-color: #ff0000; }
    50% { box-shadow: 0 0 35px #ff0000, inset 0 0 20px #ff0000; border-color: #ff3333; }
    100% { box-shadow: 0 0 20px #ff0000, inset 0 0 10px #ff0000; border-color: #ff0000; }
  }

  #box { 
    position: relative; width: 310px; height: 310px; border-radius: 50%; overflow: hidden; 
    border: 3px solid #ff0000; box-sizing: border-box; 
    background-image: linear-gradient(45deg, #1a1a1c 25%, transparent 25%), linear-gradient(-45deg, #1a1a1c 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #1a1a1c 75%), linear-gradient(-45deg, transparent 75%, #1a1a1c 75%);
    background-color: transparent; background-size: 20px 20px;
    animation: neonPulse 2s infinite ease-in-out;
    z-index: 10; 
  }
  canvas#c { position: absolute; top: 50%; left: 50%; width: 310px; height: 310px; transform: translate(-50%, -50%); z-index: 15; touch-action: none; }
  .ui { margin-top: 20px; width: 310px; display: flex; flex-direction: column; gap: 6px; }
  .btn { background: #111; border: 2px solid #ffffff; color: white; padding: 10px; text-align: center; border-radius: 8px; font-weight: bold; display: block; font-size: 12px; cursor: pointer; text-transform: uppercase; width: 100%; box-sizing: border-box; }
  .btn:disabled { opacity: 0.3; cursor: not-allowed; }
  .lbl { font-size: 9px; color: #888; text-transform: uppercase; margin-top: 2px; display: flex; justify-content: space-between; align-items: center; width: 100%; }
  .val-tag { color: #ff0000; font-weight: bold; font-family: monospace; font-size: 10px; }

  /* --- ‚úçÔ∏è FONT STUDIO CSS --- */
  .font-input { width: 100%; background: #111; border: 2px solid #00ffff; color: #fff; padding: 15px; border-radius: 8px; font-weight: bold; text-align: center; margin-bottom: 15px; font-size: 16px; outline: none; box-sizing: border-box; }
  .font-scroll { width: 100%; max-height: 500px; overflow-y: auto; display: flex; flex-direction: column; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); box-sizing: border-box; }
  .font-item { background: #1a1a1c; border-bottom: 1px solid rgba(255,255,255,0.1); padding: 16px; width: 100%; text-align: center; cursor: pointer; color: #eee; font-size: 16px; white-space: pre-wrap; }

  /* --- ‚ú® SYMBOLS STUDIO CSS --- */
  .sym-box-container { width: 100%; margin-bottom: 15px; }
  .sym-input { width: 100%; background: #000; border: 1px solid #00ffff; color: #00ffff; padding: 12px; font-size: 18px; border-radius: 6px; text-align: center; box-sizing: border-box; outline: none; }
  .cat-title { width: 100%; color: #ff0000; font-size: 12px; font-weight: bold; margin: 20px 0 5px 0; text-transform: uppercase; padding-left: 5px; border-bottom: 1px solid rgba(255,0,0,0.2); padding-bottom: 5px; }
  .sym-grid { display: flex; flex-wrap: wrap; gap: 5px; width: 100%; padding: 5px; box-sizing: border-box; }
  .sym-btn { background: #1a1a1c; border: 1px solid #333; color: white; padding: 15px 0; font-size: 20px; border-radius: 6px; cursor: pointer; text-align: center; flex: 1 0 18%; }

  /* --- ‚ö° GIF STUDIO CSS --- */
  .stage { position: relative; width: 320px; height: 320px; display: flex; align-items: center; justify-content: center; margin-bottom: 30px; }
  .led-ring { position: absolute; inset: -15px; border-radius: 50%; background: conic-gradient(from 0deg, #00f3ff, #bc13fe, #ff0055, #00f3ff); animation: rotate 1.0s linear infinite; filter: blur(20px); z-index: 1; }
  @keyframes rotate { 100% { transform: rotate(360deg); } }
  .viewport { position: relative; z-index: 5; width: 100%; height: 100%; border-radius: 50%; overflow: hidden; background-color: #000; display: flex; justify-content: center; align-items: center; box-shadow: inset 0 0 20px #000; }
  #v { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); pointer-events: none; will-change: transform; }
  #o { width: 100%; height: 100%; object-fit: contain; display: none; }
  .ui-gif { background: rgba(10, 10, 10, 0.9); padding: 25px; border-radius: 30px; width: 340px; border: 1px solid rgba(255,255,255,0.1); display: flex; flex-direction: column; align-items: center; }
  .btn-upload { background: linear-gradient(90deg, #00f3ff, #bc13fe); color: #000; border: none; padding: 15px; border-radius: 50px; font-weight: 800; cursor: pointer; width: 100%; margin-bottom: 25px; font-size: 14px; }
  .btn-inner { position: relative; display: block; text-decoration: none; text-align: center; color: white; background: #000; padding: 12px 30px; border-radius: 48px; font-weight: 900; font-size: 14px; z-index: 1; cursor: pointer; border: none; width: 100%; box-sizing: border-box; }
  
  input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; margin: 10px 0; }
  input[type=range]::-webkit-slider-runnable-track { height: 8px; background: linear-gradient(to right, #ff0000 var(--v, 0%), #00ffff var(--v, 0%)); border-radius: 4px; }
  input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 20px; width: 20px; border-radius: 50%; background: #ff0000; margin-top: -6px; border: 2px solid #fff; }

  .status { margin-top: 20px; font-size: 14px; text-align: center; color: #00f3ff; font-weight: 600; opacity: 0; }
  .status.active { opacity: 1; }
  .neon-wrap { position: relative; width: 100%; margin-top: 15px; padding: 3px; border-radius: 50px; overflow: hidden; }
  .neon-wrap.blue::before { content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: conic-gradient(transparent, transparent, #00f3ff, #bc13fe, #ff0055, #00f3ff, transparent, transparent); animation: rotate 4.0s linear infinite; z-index: 0; }
  
  input[type=file], #yt-player { display: none; }
</style>
</head>
<body>

<button class="menu-toggle" onclick="toggleMenu(event)">MENU ‚ò∞</button>
<button id="view-toggle" onclick="toggleViewMode()">üñ•Ô∏è</button>

<div id="menu-panel">
  <div class="switch-container">
    <button id="switch-btn" onclick="toggleSwitchMenu(event)">SWITCH TO üìÇ</button>
    <div id="switch-menu">
      <button id="nav-frame" class="active-link" onclick="changeStudio('frame')">üñºÔ∏è Frame Studio</button>
      <button id="nav-font" onclick="changeStudio('font')">‚úçÔ∏è Font Generator</button>
      <button id="nav-gif" onclick="changeStudio('gif')">‚ö° GIF Maker</button>
      <button id="nav-sym" onclick="changeStudio('sym')">‚ú® Symbols Studio</button>
    </div>
  </div>

  <div class="music-section">
    <div class="music-btn" style="display:flex; justify-content:space-between; font-size:12px; font-weight:bold; cursor:pointer;" onclick="toggleMusic()">
      <span>MUSIC PLAYER</span> <span id="m-status" style="color:#ff0000;">ON</span>
    </div>
    <select class="station-select" style="width:100%; margin-top:5px;" onchange="changeMusic(this.value)">
      <option value="jfKfPfyJRdk" selected>‚òï Lofi Focus</option>
      <option value="nv_2rz5BFDA">üïπÔ∏è Retro Wave</option>
    </select>
  </div>
  
  <div class="designed-by">DESIGNED BY <b>RISK</b></div>
</div>

<div id="yt-player"></div>

<h1 id="studio-name">ARCADE</h1>
<p class="sub" id="studio-sub">FRAME STUDIO</p>

<div id="frame-studio" class="studio-sec active-sec">
  <div id="box"><canvas id="c" width="800" height="800"></canvas></div>
  <div class="ui">
    <label class="btn" onclick="playClick()">CHOOSE IMAGE<input type="file" id="u1" accept="image/*" onchange="handleFile(event)" style="display:none"></label>
    <label class="btn" onclick="playClick()">APPLY FRAME<input type="file" id="u2" accept="image/*" onchange="handleFrame(event)" style="display:none"></label>
    <button class="btn" style="border-color:#00ffff; color:#00ffff;" onclick="centerSubject()">CENTER SUBJECT üéØ</button>
    <button class="btn" style="border-color:#ff0000; color:#ff0000;" onclick="resetProject()">RESET PROJECT ‚Üª</button>
    <div class="lbl">ZOOM <span id="z-val" class="val-tag">100%</span></div>
    <input type="range" id="z" min="0.1" max="2.5" step="0.01" value="1" oninput="updateZ(this.value)">
    <div class="lbl">ROTATE <span id="r-val" class="val-tag">0¬∞</span></div>
    <input type="range" id="r" min="0" max="360" step="1" value="0" oninput="updateR(this.value)">
    <div class="lbl">CIRCLE SIZE <span id="m-val" class="val-tag">375px</span></div>
    <input type="range" id="m" min="300" max="400" step="1" value="375" oninput="updateM(this.value)">
    <button id="save" class="btn" onclick="downloadPic()" disabled>DOWNLOAD PICTURE</button>
  </div>
</div>

<div id="font-studio" class="studio-sec">
  <input type="text" id="font-input" class="font-input" placeholder="Type text here..." oninput="genFonts()">
  <div id="font-results" class="font-scroll"></div>
</div>

<div id="gif-studio" class="studio-sec">
    <div class="stage" id="stage"><div class="led-ring"></div><div class="viewport" id="vp"><video id="v" muted playsinline loop></video><img id="o"></div></div>
    <div class="ui-gif">
        <button class="btn-upload" id="upBtn" onclick="document.getElementById('gfInput').click()">UPLOAD VIDEO</button>
        <input type="file" id="gfInput" accept="video/*" style="display:none">
        <div class="label-row"><span>ZOOM</span><span id="zv">100%</span></div>
        <input type="range" id="zoom" min="100" max="300" step="1" value="100">
        <div class="label-row"><span>SPEED</span><span id="sv">1.0x</span></div>
        <input type="range" id="speed" min="0.5" max="3.0" step="0.1" value="1.0">
        <div class="neon-wrap blue"><button id="go" class="btn-inner" disabled>‚ö° CREATE HD GIF</button></div>
        <div id="msg" class="status">Processing...</div>
        <div id="dlBox" class="neon-wrap blue" style="display:none; margin-top:10px;"><a id="dl" class="btn-inner">‚¨áÔ∏è DOWNLOAD GIF</a></div>
    </div>
</div>

<div id="sym-studio" class="studio-sec">
    <input type="text" id="sym-box" class="sym-input" placeholder="Type or tap symbols here...">
    <div id="sym-container" class="font-scroll"></div>
</div>

<script src="https://www.youtube.com/iframe_api"></script>
<script>
const c=document.getElementById('c'),x=c.getContext('2d'),zSl=document.getElementById('z'),rSl=document.getElementById('r'),mSl=document.getElementById('m'),panel=document.getElementById('menu-panel'),mStat=document.getElementById('m-status'), sName=document.getElementById('studio-name'), sSub=document.getElementById('studio-sub'), swMenu=document.getElementById('switch-menu');
const zVal=document.getElementById('z-val'),rVal=document.getElementById('r-val'),mVal=document.getElementById('m-val');
let i=new Image(),f=new Image(),cfg={s:1,m:375,x:400,y:400,r:0},player,musicOn=true,audioStarted=false;
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
const viewBtn = document.getElementById('view-toggle'); let isPC = false;

window.onclick = e => {
  initAudio();
  if (panel.classList.contains('open') && !panel.contains(e.target) && !e.target.classList.contains('menu-toggle')) panel.classList.remove('open');
  if (swMenu.style.display === 'flex' && !document.querySelector('.switch-container').contains(e.target)) swMenu.style.display = 'none';
};

function toggleMenu(e) { e.stopPropagation(); playClick(); panel.classList.toggle('open'); }
function toggleSwitchMenu(e) { e.stopPropagation(); playClick(); swMenu.style.display = swMenu.style.display === 'flex' ? 'none' : 'flex'; }
function toggleViewMode() { isPC = !isPC; document.body.classList.toggle('pc-mode', isPC); viewBtn.innerText = isPC ? "üì±" : "üñ•Ô∏è"; }

function changeStudio(mode) {
  playClick(); document.querySelectorAll('.studio-sec').forEach(s => s.classList.remove('active-sec'));
  swMenu.style.display = 'none'; panel.classList.remove('open');
  document.getElementById(mode + '-studio').classList.add('active-sec');
  sName.innerText = (mode === 'frame' ? "ARCADE" : mode.toUpperCase()); 
  sSub.innerText = mode.toUpperCase() + " STUDIO";
}

// --- ‚úçÔ∏è FONTS ---
const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
const alphas = [
  {m:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"},
  {m:"ùêÄùêÅùêÇùêÉùêÑùêÖùêÜùêáùêàùêâùêäùêãùêåùêçùêéùêèùêêùêëùêíùêìùêîùêïùêñùêóùêòùêôùêöùêõùêúùêùùêûùêüùê†ùê°ùê¢ùê£ùê§ùê•ùê¶ùêßùê®ùê©ùê™ùê´ùê¨ùê≠ùêÆùêØùê∞ùê±ùê≤ùê≥ùüéùüèùüêùüëùüíùüìùüîùüïùüñùüó"},
  {m:"ùê¥ùêµùê∂ùê∑ùê∏ùêπùê∫ùêªùêºùêΩÔº´Ôº¨Ôº≠ùëÅùëÇùëÉùëÑùëÖùëÜùëáùëàùëâùëäùëãùëåùëçùëéùëèÔΩÉÔΩÑÔΩÖùëìÔΩá‚ÑéÔΩâùëóùëòÔΩåÔΩçÔΩéÔΩèÔΩêùëûùëüùë†ùë°ùë¢ùë£ùë§ùë•ÔΩôÔΩö0123456789"},
  {m:"ùë®ùë©ùë™ùë´ùë¨ùë≠ùëÆùëØùë∞ùë±ùë≤ùë≥ùë¥ùëµùë∂ùë∑ùë∏ùëπùë∫ùëªùëºùëΩùëæùëøùíÄùíÅùíÇùíÉùíÑùíÖùíÜùíáùíàùíâùíäùíãùíåùíçùíéùíèùíêùíëùííùíìùíîùíïùíñùíóùíòùíôùíöùíõ0123456789"},
  {m:"ùíú‚Ñ¨ùíûùíü‚Ñ∞‚Ñ±ùí¢‚Ñã‚Ñêùí•ùí¶‚Ñí‚Ñ≥‚í©‚í™‚í´‚í¨‚ÑõùíÆùíØùí∞‚í±‚í≤‚í≥‚í¥‚íµùí∂‚í∑ùí∏ùíπ‚ÑØùíª‚ÑäùíΩùíæùíøùìÄùìÅùìÇùìÉ‚Ñ¥ùìÖùìÜùìáùìàùìâùíñ‚ìãùìåùìçùìéùìè0123456789"},
  {m:"ùìêùìëùìíùììùìîùìïùìñùìóùìòùìôùìöùìõùìúùìùùìûùìüùì†ùì°ùì¢ùì£ùì§ùì•ùì¶ùìßùì®ùì©ùì™ùì´ùì¨ùì≠ùìÆùìØùì∞ùì±ùì≤ùì≥ùì¥ùìµùì∂ùì∑ùì∏ùìπìãºùîÄùîÅùîÇùîÉ0123456789"},
  {m:"ùñ†ùñ°ùñ¢ùñ£ùñ§ùñ•ùñ¶ùñßùñ®ùñ©ùñ™ùñ´ùñ¨ùñ≠ùñÆùñØùñ∞ùñ±ùñ≤ùñ≥ùñ¥‚ìãùñÇùñÉùñÑùñÖùñ∫ùñªùñºùñΩùñæùñøùóÄùóÅùóÇùóÉùóÑùóÖùóÜùóáùóàùóâùóäùóãùóåùóçùóé‚ìãùóêùóëùóíùóìùü¢ùü£ùü§ùü•ùü¶ùüßùü®ùü©ùü™ùü´"},
  {m:"ùóîùóïÔº£ùóóÔº•ùóôùóöÔº®Ôº©Ôº™Ôº´Ôº¨Ôº≠ÔºÆÔºØÔº∞ùó§ùó•ùó¶Ôº¥ùó®‚ìãùó™ùó´Ôºπùó≠ùóÆùóØùó∞ÔΩÑÔΩÖÔΩÜÔΩáùóµÔΩâùëóÔΩãÔΩåÔΩçÔΩéÔΩèÔΩêùóæÔΩíÔΩìÔΩîÔΩïùêØÔΩóùòÖÔΩôÔΩöùü¨ùü≠ùüÆùüØùü∞ùü±ùü≤ùü≥ùü¥ùüµ"},
  {m:"ùòàùòâùòäùòãùòåùòçùòéùòèùòêùòëùòíùòìùòîùòïùòñùòóùòòùòôùòöùòõùòúùòùùòûùòüùò†ùò°ùò¢ùò£ÔΩÉÔΩÑÔΩÖÔΩÜÔΩáÔΩàÔΩâùëóùëòÔΩåÔΩçÔΩéÔΩèÔΩêùò≤ùò≥ùò¥ùòµùë¢ùë£ùë§ùë•ÔΩôÔΩö0123456789"},
  {m:"ùòºùòΩùòæùòøùôÄùôÅùôÇùôÉÔº©ùôÖùôÜùôáùôàÔºÆÔºØÔº∞ùôåùôçùôéÔº¥ùôêùôëùôíùôìÔºπùôïùôñùôóùôòÔΩÑÔΩÖÔΩÜùôúùôùùôûùôüùô†ùô°ùì∂ÔΩéÔΩèùô•ùô¶ùôßùë†ùë°ùô™ùô´ùô¨ùô≠ùôÆùôØ0123456789"},
  {m:"ùô∞ùô±Ôº£Ôº§Ôº•Ôº¶ùô∂Ôº®ùô∏ùôπùô∫ùôªÔº≠ÔºÆÔºØÔº∞ùöÄùöÅùöÇÔº¥ùöÑ‚ìãùöÜùöáÔºπùöâùöäùöãùöåùöçùöéùöèÂ∞äÔΩàÔΩâùëóÔΩãÔΩåÔΩçÔΩéÔΩèÔΩêùööùöõÔΩìùöùùöûùë£ùö†ùö°ùö¢ùö£ùü∂ùü∑ùü∏ùüπùü∫ùüªùüºùüΩùüæùüø"},
  {m:"ùî∏ùîπ‚ÑÇùîªùîºùîΩùîæ‚ÑçùïÄùïÅùïÇùïÉùïÑ‚ÑïùïÜ‚Ñô‚Ñö‚Ñùùïäùïãùïåùïçùïéùïèùïê‚Ñ§ùïíùïìùïîùïïùïñùïóùïòùïôüáÆüá≥ùïõùïúùïùùïûùëõùï†ùê©ùï¢ùï£ùï§ùï•ùï¶ùïßùï®ùï©ùï™ùï´ùüòùüôùüöùüõùüúùüùùüûùüüùü†ùü°"},
  {m:"ùîÑùîÖ‚Ñ≠ùîáùîàùîâùîä‚Ñå‚Ñëùîçùîéùîèùîêùîëùîíùîìùîî‚Ñúùîñùîóùîòùîôùîöùîõùîú‚Ñ®ùîûùîüùî†ùî°ùî¢ùî£ùî§ùî•ùî¶ùîßùî®ùî©ùî™ùî´ùî¨ùî≠ùîÆùîØùî∞≈ßùî≤ùî≥ùî¥ùîµùî∂ùî∑0123456789"},
  {m:"ùï¨ùï≠ùïÆùïØùï∞ùï±ùï≤ùï≥ùï¥ùïµùï∂ùï∑ùï∏ùïπùï∫ùïªùïºùïΩùïæùïøùñÄùñÅùñÇùñÉùñÑùñÖùñÜùñáùñàùñâùñäùñãùñåùñçùñéùñèùñêùñëùñíùñìùñîùñïùññùñóùñòùñôùñöùñõùñúùñùùñûùñü0123456789"},
  {m:"‚Ç≥‡∏ø‚Çµƒê…Ü‚Ç£‚Ç≤‚±ß≈ÇJ‚Ç≠‚±†‚Ç•‚Ç¶√ò‚Ç±Q‚±§‚Ç¥‚ÇÆ…ÑV‚Ç©”æ…é‚±´‚Ç≥‡∏ø‚Çµƒê…Ü‚Ç£‚Ç≤‚±ß≈ÇJ‚Ç≠‚±†‚Ç•‚Ç¶√ò‚Ç±Q‚±§‚Ç¥‚ÇÆ…ÑV‚Ç©”æ…é‚±´0123456789"},
  {m:"»∫∆Ä√ßƒê…áf«§ƒß…®…âÍùÅ≈ÇmN√∏·µΩÍùó…çs≈ß·µævwxy∆µ»∫∆Ä√ßƒê…áf«§ƒß…®…âÍùÅ≈ÇmN√∏·µΩÍùó…çs≈ß·µævwxy∆µ0123456789"},
  {m:"Œ±–≤c‚àÇ—î∆íg–ΩŒπ◊†–∫‚Ñì–º–∏œÉœÅq—è—ï—ÇœÖŒΩœâœá—ÉzŒ±–≤c‚àÇ—î∆íg–ΩŒπ◊†–∫‚Ñì–º–∏œÉœÅq—è—ï—ÇœÖŒΩœâœá—Éz0123456789"},
  {m:"ŒõB·ÑÉDŒ£FGŒâIJKLM–ü”®PQ–Ø∆ß∆¨–¶V–©XYZŒõB·ÑÉDŒ£FGŒâIJKLM–ü”®PQ–Ø∆ß∆¨–¶V–©XYZ0123456789"},
  {m:"–î–ëCDŒûFGH≈ÇJ“úLM–ò–§P«™–ØSŒì–¶V–©XYZ–¥—äcdŒæfg–ΩŒπjŒ∫l–ºn√∏pq—ès—Ç—Üvœâx—áz0123456789"},
  {m:"Ôæë‰πÉcd‰πáfG„ÇìÔæâj„Ç∫lmÂàÄoÔΩ±qÂ∞∫sÔΩ≤u‚àöwÔæíÔæòzÔæë‰πÉcd‰πáfG„ÇìÔæâj„Ç∫lmÂàÄoÔΩ±qÂ∞∫sÔΩ≤u‚àöwÔæíÔæòz0123456789"}
];

function genFonts(){
  const val=document.getElementById('font-input').value, resBox=document.getElementById('font-results');
  resBox.innerHTML=""; if(!val) return;
  alphas.forEach(alph => {
    let txt = ""; const mapArr = Array.from(alph.m);
    for(let char of val){ let idx = chars.indexOf(char); txt += (idx !== -1 && mapArr[idx]) ? mapArr[idx] : char; }
    addF(txt, resBox);
  });
}
function addF(t,b){let d=document.createElement('div');d.className="font-item";d.innerText=t;d.onclick=()=>{navigator.clipboard.writeText(t);playShutter();};b.appendChild(d);}

// --- ‚ú® SYMBOLS (FIXED CURSOR POSITION INSERTION) ---
const symData = {
    "Hearts": ["‚ù§","‚ù•","‚ô°","‚ô•","‚ù¶","‚ùß","‚ù£","üíû","üíó","üíï","üíò","üíù","üíü","üíå","üíã","÷∂÷¢÷∏","·µïÃà","‚ù£Ô∏é","-'‚ô°'-","·•´·≠°","„ÄÇ‚ô°","ÃÜÃà","‚ô°Ô∏é","·¢âê≠©","·•´·≠°.","ÀóÀãÀè ‚ô° ÀéÀäÀó","Àö‚Çä¬∑ ÕüÕüÕûÕû‚û≥‚ù•","ñ®Ü‚ô°ñ®Ü","ŸÄŸÄŸÄŸÄŸÄŸÄŸÄŸÄŸÄŸÄŸÄŸÄŸÄŸÄŸÄÔÆ©Ÿ®ŸÄ‚ù§Ô∏èÔ∏è","‚ô° ·™≤·™≤·™≤","üñ§‚Éùü¶ã","êÄ∂"],
    "Sparkles & Stars": ["‚ú®","‚òÖ","‚òÜ","‚ú°","‚ú¶","‚úß","‚ú©","‚ú™","‚ú´","‚ú¨","‚ú≠","‚úÆ","‚úØ","‚ú∞","‚ÅÇ","‚Åé","‚Åë","‚ú¢","‚ú£","‚ú§","‚ú•","‚ú±","‚ú≤","‚ú≥","‚ú¥","‚úµ","‚ú∂","‚ú∑","‚ú∏","‚úπ","‚ú∫","‚úª","‚úº","‚úΩ","‚úæ","‚úø","‚ùÄ","‚ùÅ","‚ùÇ","‚ùÉ","‚ùÑ","‚ùÖ","‚ùÜ","‚ùá","‚ùà","‚ùâ","‚ùä","‚ùã"],
    "Zodiac": ["‚ôàÔ∏é","‚ôâÔ∏é","‚ôäÔ∏é","‚ôãÔ∏é","‚ôåÔ∏é","‚ôçÔ∏é","‚ôéÔ∏é","‚ôèÔ∏é","‚ôêÔ∏é","‚ôëÔ∏é","‚ôíÔ∏é","‚ôìÔ∏é"]
};

function renderSymbols(){
    const box = document.getElementById('sym-container'); box.innerHTML = "";
    for (const [category, symbols] of Object.entries(symData)) {
        let title = document.createElement('div'); title.className = "cat-title"; title.innerText = category; box.appendChild(title);
        let grid = document.createElement('div'); grid.className = "sym-grid";
        symbols.forEach(s => {
            let btn = document.createElement('div'); btn.className = "sym-btn"; btn.innerText = s;
            btn.onclick = () => { 
                const tb = document.getElementById('sym-box');
                const start = tb.selectionStart; const end = tb.selectionEnd;
                const v = tb.value;
                tb.value = v.substring(0, start) + s + v.substring(end);
                tb.selectionStart = tb.selectionEnd = start + s.length;
                tb.focus(); playClick(); 
            };
            grid.appendChild(btn);
        });
        box.appendChild(grid);
    }
}
renderSymbols();

// --- ‚ö° TURBO GIF ENGINE (HD) ---
const workerBlob = new Blob([`importScripts('https://cdnjs.cloudflare.com/ajax/libs/gif.js/0.2.0/gif.worker.js');`], { type: 'application/javascript' });
const workerUrl = URL.createObjectURL(workerBlob);

const gfInput=document.getElementById('gfInput'), upBtn=document.getElementById('upBtn'), v=document.getElementById('v'), o=document.getElementById('o'), vp=document.getElementById('vp');
const speed=document.getElementById('speed'), sv=document.getElementById('sv'), zoom=document.getElementById('zoom'), zv=document.getElementById('zv'), go=document.getElementById('go'), msg=document.getElementById('msg');
const dlBox=document.getElementById('dlBox'), dl=document.getElementById('dl');

let gifX = 0, gifY = 0; let vidW = 0, vidH = 0; 

function resetGifProject() {
  playClick(); v.src=''; o.style.display='none'; v.style.display='none';
  dlBox.style.display='none'; go.style.display='block'; go.disabled=true; 
  upBtn.disabled=false; zoom.disabled=false; speed.disabled=false; msg.classList.remove('active');
  zoom.value=100; zv.innerText="100%"; gifX = 0; gifY = 0;
}

gfInput.onchange=(e)=>{ 
    const file=e.target.files[0]; if(!file)return;
    v.style.display='block'; o.style.display='none'; v.src=URL.createObjectURL(file);
    v.onloadedmetadata=()=>{ vidW = v.videoWidth; vidH = v.videoHeight; setCover(); v.play(); go.disabled=false; };
};

function setCover() {
    const boxSize = 320; const aspect = vidW / vidH;
    if(aspect > 1) { v.style.height = boxSize + 'px'; v.style.width = (boxSize * aspect) + 'px'; }
    else { v.style.width = boxSize + 'px'; v.style.height = (boxSize / aspect) + 'px'; }
    updateGif();
}

function updateGif() {
    const z = parseInt(zoom.value)/100;
    v.style.transform = `translate(calc(-50% + ${gifX}px), calc(-50% + ${gifY}px)) scale(${z})`;
}

zoom.oninput = function() { zv.innerText = this.value + '%'; updateGif(); };
speed.oninput=()=>{ sv.innerText=speed.value+'x'; v.playbackRate=parseFloat(speed.value); };

// Dragging Logic
let isDrag = false, sx, sy, ix, iy;
vp.onmousedown = e => { if(!v.src) return; isDrag=true; sx=e.clientX; sy=e.clientY; ix=gifX; iy=gifY; };
window.onmousemove = e => { if(!isDrag) return; gifX=ix+(e.clientX-sx); gifY=iy+(e.clientY-sy); updateGif(); };
window.onmouseup = () => isDrag=false;

go.onclick=()=>{
    if(!v.src)return; playClick(); go.disabled=true; msg.classList.add('active');
    // High performance config
    const gif=new GIF({workers:25, quality:10, width:360, height:360, workerScript:workerUrl, dither:false});
    const canvas=document.createElement('canvas'); canvas.width=360; canvas.height=360; const ctx=canvas.getContext('2d');
    const fps=15, dur=v.duration, capV=document.createElement('video'); capV.src=v.src;
    capV.onloadeddata=()=>{
        let ct=0; const scale=parseInt(zoom.value)/100, aspect=capV.videoWidth/capV.videoHeight;
        let dw, dh; if(aspect>1){ dh=360; dw=360*aspect; } else { dw=360; dh=360/aspect; }
        dw*=scale; dh*=scale; const dx=(360-dw)/2+(gifX*(360/320)); const dy=(360-dh)/2+(gifY*(360/320));
        const capture=()=>{ if(ct>=dur){ msg.innerText="Encoding HD..."; gif.render(); return; } capV.currentTime=ct; };
        capV.onseeked=()=>{ ctx.fillStyle='#000'; ctx.fillRect(0,0,360,360); ctx.drawImage(capV,dx,dy,dw,dh); gif.addFrame(ctx,{copy:true, delay:1000/fps}); ct+=(1/fps); setTimeout(capture, 1); };
        capture();
    };
    gif.on('finished', blob=>{ const u=URL.createObjectURL(blob); v.style.display='none'; o.src=u; o.style.display='block'; dl.href=u; dl.download=`arcade_${Date.now()}.gif`; dlBox.style.display='block'; msg.classList.remove('active'); go.style.display='none'; });
};

// --- AUDIO & CORE ---
function initAudio(){ if(!audioStarted){ audioCtx.resume().then(()=>{ audioStarted=true; if(player&&musicOn){ player.unMute(); player.playVideo(); }});}}
function toggleMusic(){ musicOn=!musicOn; if(player){ musicOn?player.playVideo():player.pauseVideo(); mStat.innerText=musicOn?"ON":"OFF"; mStat.style.color=musicOn?"#ff0000":"#888"; } playClick(); }
function changeMusic(id){ player.loadVideoById(id); }
function playClick(){ if(audioCtx.state!=='running')audioCtx.resume(); const o=audioCtx.createOscillator(), g=audioCtx.createGain(); o.connect(g); g.connect(audioCtx.destination); o.type='sine'; o.frequency.setValueAtTime(800, audioCtx.currentTime); g.gain.setValueAtTime(0.02, audioCtx.currentTime); o.start(); o.stop(audioCtx.currentTime+0.1); }
function playShutter(){ if(audioCtx.state!=='running')audioCtx.resume(); const o=audioCtx.createOscillator(), g=audioCtx.createGain(); o.type='square'; o.frequency.setValueAtTime(150, audioCtx.currentTime); g.gain.setValueAtTime(0.02, audioCtx.currentTime); o.connect(g); g.connect(audioCtx.destination); o.start(); o.stop(audioCtx.currentTime+0.1); }
function onYouTubeIframeAPIReady(){ player=new YT.Player('yt-player',{height:'0',width:'0',videoId:'jfKfPfyJRdk',playerVars:{'autoplay':1,'loop':1,'playlist':'jfKfPfyJRdk','mute':0},events:{'onReady':e=>{e.target.setVolume(25);}}});}

// --- üñºÔ∏è FRAME ENGINE (WITH 360 LOCK & NO BACKGROUND LEAK) ---
function d(){ 
  x.clearRect(0,0,800,800); 
  if(i.src){
      const circleR = cfg.m; const rad = cfg.r * Math.PI / 180;
      const absCos = Math.abs(Math.cos(rad)), absSin = Math.abs(Math.sin(rad));
      // Calculate minimum scale needed so that even when rotated, the image covers the circle
      const minW = (circleR * 2 * absCos + circleR * 2 * absSin);
      const minH = (circleR * 2 * absSin + circleR * 2 * absCos);
      const currentMinScale = Math.max(minW/i.width, minH/i.height);
      if(cfg.s < currentMinScale) cfg.s = currentMinScale;

      const rangeX = (i.width * cfg.s - minW) / 2;
      const rangeY = (i.height * cfg.s - minH) / 2;
      cfg.x = Math.max(400 - rangeX, Math.min(400 + rangeX, cfg.x));
      cfg.y = Math.max(400 - rangeY, Math.min(400 + rangeY, cfg.y));
  }
  x.save(); x.beginPath(); x.arc(400,400,cfg.m,0,Math.PI*2); x.clip(); 
  if(i.src){ x.save(); x.translate(cfg.x,cfg.y); x.rotate(cfg.r*Math.PI/180); x.drawImage(i,-i.width*cfg.s/2,-i.height*cfg.s/2,i.width*cfg.s,i.height*cfg.s); x.restore(); } 
  x.restore(); if(f.src) x.drawImage(f,0,0,800,800); 
}

function handleFile(e){ 
  let r=new FileReader(); r.onload=v=>{ 
    let n=new Image(); n.onload=()=>{ i=n; cfg.s=Math.max(800/i.width,800/i.height); cfg.x=400; cfg.y=400; zSl.min=cfg.s; zSl.value=cfg.s; updS(zSl); d(); playClick(); document.getElementById('save').disabled=false; }; 
    n.src=v.target.result; 
  }; r.readAsDataURL(e.target.files[0]); 
}
function handleFrame(e){ let r=new FileReader(); r.onload=v=>{ let n=new Image(); n.onload=()=>{f=n; d(); playClick();}; n.src=v.target.result; }; r.readAsDataURL(e.target.files[0]); }
function updateZ(v){ cfg.s=parseFloat(v); zVal.innerText=Math.round((v/zSl.min)*100)+"%"; d(); }
function updateR(v){ cfg.r=parseInt(v); rVal.innerText=v+"¬∞"; d(); }
function updateM(v){ cfg.m=parseInt(v); mVal.innerText=v+"px"; d(); }
function centerSubject(){ cfg.x=400; cfg.y=400; cfg.r=0; rSl.value=0; d(); playClick(); }
function resetProject(){ i=new Image(); f=new Image(); cfg={s:1,m:375,x:400,y:400,r:0}; zSl.value=1; rSl.value=0; mSl.value=375; updS(zSl); updS(rSl); updS(mSl); d(); playClick(); document.getElementById('save').disabled=true; }
function downloadPic(){ d(); let a=document.createElement('a'); a.download=`Arcade_${Date.now()}.png`; a.href=c.toDataURL(); a.click(); playClick(); }
function updS(el){ if(el && !el.parentElement.classList.contains('ui-gif')) el.style.setProperty('--v', ((el.value-el.min)/(el.max-el.min)*100)+'%'); }
document.querySelectorAll('input[type=range]').forEach(el => { el.addEventListener('input', () => updS(el)); updS(el); });

// --- üì± 2-FINGER TOUCH LOGIC ---
let isP=false, tSt={x:0,y:0}, initDist=0, initScale=1, initAng=0, initRot=0;
c.ontouchstart=e=>{
    e.preventDefault();
    if(e.touches.length===1){ isP=true; tSt={x:e.touches[0].clientX,y:e.touches[0].clientY}; }
    else if(e.touches.length===2){
        isP=false;
        const dx=e.touches[0].clientX-e.touches[1].clientX, dy=e.touches[0].clientY-e.touches[1].clientY;
        initDist=Math.sqrt(dx*dx+dy*dy); initScale=cfg.s;
        initAng=Math.atan2(dy,dx); initRot=cfg.r;
    }
};
c.ontouchmove=e=>{
    e.preventDefault();
    if(e.touches.length===1 && isP){
        const sc=800/c.offsetWidth; cfg.x+=(e.touches[0].clientX-tSt.x)*sc; cfg.y+=(e.touches[0].clientY-tSt.y)*sc;
        tSt={x:e.touches[0].clientX,y:e.touches[0].clientY}; d();
    } else if(e.touches.length===2){
        const dx=e.touches[0].clientX-e.touches[1].clientX, dy=e.touches[0].clientY-e.touches[1].clientY;
        const dist=Math.sqrt(dx*dx+dy*dy), scale=dist/initDist;
        cfg.s=Math.min(zSl.max, Math.max(zSl.min, initScale*scale));
        zSl.value=cfg.s; updS(zSl); zVal.innerText=Math.round((cfg.s/zSl.min)*100)+"%";
        const ang=Math.atan2(dy,dx); cfg.r=(initRot+(ang-initAng)*180/Math.PI)%360;
        rSl.value=cfg.r; updS(rSl); rVal.innerText=Math.round(cfg.r)+"¬∞"; d();
    }
};
window.ontouchend=()=>isP=false;
</script>
</body>
</html>
